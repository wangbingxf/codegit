$define(["wgt_util","jquery.formValidate","md5","jquery.message","laydate"],function(e,t,a,i,n,r,s){var o=function(t,a,i,n,r,s,o){var c={};c.request_url=i,c.url_param=n,c.requst_type=r||"GET";var d=encodeURIComponent(encodeURIComponent(JSON.stringify(c))),p=e.md5Sign(JSON.stringify(c));e.ajax({type:"POST",url:"/",async:o||void 0===o,data:{param:d,sign:p},success:function(e){s(e,t,a)},error:function(){getFailPop(t,"操作失败！")}})},c=function(t,a,i,n,r){e.ajax({type:i,url:t,dataType:"json",async:!1,data:a,success:function(e){n(e)},error:function(e){console.log(e,"err")}})},d=function(){function t(e,t){t.removeClass("success").addClass("error"),t.find(".p_LoginPrompt").remove().end().append(v),t.find(".text-error").text(e.attr("data-error")),e.data("status",0)}function a(e,t,a){if(t.removeClass("success").addClass("error"),t.find(".p_LoginPrompt").remove().end().append(v),t.find(".text-error").text(a),""!=t.find(".text-error").text(a))return l=a,l;e.data("status",0)}function i(e,t){t.removeClass("error success"),t.find(".p_LoginPrompt").remove()}function n(e,n){var r=e.val(),s=e.parent(),c=e.attr("name"),l=e.attr("data-type"),m=e.attr("data-subType"),h=(r.length,/(^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$)/g),v=/^[0-9-()（）]{7,18}$/g,x=/^[1-9]\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/,y=/^[0-9]*$/,b=e.attr("tit"),C=!e.attr("data-required")||"true"==e.attr("data-required"),k=!1;if(n&&(r=n),C?r&&""!=r.trim()?k=!0:("en"==window.tenant.language?a(e,s,b+" "+d.mp):a(e,s,b+d.mp),f=!1):r&&""!=r.trim()?k=!0:(i(e,s),f=!1),k){if(_(e,s),1==l)if(2==m)y.test(r)?_(e,s):(a(e,s,d.number),f=!1);else if(3==m){var w=window.tenant.foreign?new RegExp:/^1[0-9]{10}$/;w.test(r)?_(e,s):(a(e,s,d.correct+b+d.hm),f=!1)}else 4==m?v.test(r)?_(e,s):(a(e,s,d.correct+b+d.hm),f=!1):5==m?h.test(r)?_(e,s):(a(e,s,d.correctG+b),f=!1):6==m?x.test(r)||""!=r?_(e,s):(a(e,s,d.correctG+b),f=!1):7==m&&(x.test(r)||""!=r?_(e,s):(a(e,s,d.correctG+b),f=!1));if(5e3!=e.attr("maxlength")&&"多行文本输入框"!=e.parent().data("name")||(r.indexOf("<script>")>-1&&r.indexOf("</script>")>-1?(a(e,s,d.correct+b),f=!1):_(e,s)),"captchas"==c){var T="/interactionApi/captcha/checkCaptcha",I={captchaId:p.find(".p_image img").attr("data-id"),code:r};o(p,d,T,{formData:I},"GET",function(a){if(!a.data||""===a.data)return t(e,s),void(f=!1);var i=JSON.parse(a.data);i=JSON.parse(a.data);if("101"==i.status){var n="1"==i.data.code;n?(g=!0,_(e,s)):(f=!1,g=!1,t(e,s))}else t(e,s),f=!1},!1)}if("phoneCode"==c||"mailCode"==c){T="/interactionApi/member/account/checkVerifyCode";var S="";S="phoneCode"==c?e.parents(".p_aaa").find(".p_PhoneBox input").val():e.parents(".p_aaa").find(".p_EmailBox input").val();I={compType:d.id,verifyName:S,verifyType:"SMS",verifyValue:r};"mailCode"==c&&(I.verifyType="EMAIL"),o(p,d,T,I,"GET",function(a){if(!a.data||""===a.data)return t(e,s),f=!1,void(u=!1);var i=JSON.parse(a.data);if("101"==i.status){var n="2000"==i.data.status;n?(_(e,s),u=!0):(f=!1,u=!1,t(e,s))}else t(e,s),f=!1})}}return f}function r(t,a){t.find(".p_date").each(function(){var t="#"+e(this).attr("id"),a=e(this);laydate.render({elem:t,done:function(e){n(a,e)}})}),t.find(".p_dateTime").each(function(){var t="";t=null!=e(this).attr("id")?"#"+e(this).attr("id"):"#"+e(this).find(".InputText").attr("id"),console.log(t,"xx");var a=e(this);laydate.render({elem:t,type:"datetime",done:function(e){n(a,e)}})})}function s(){var e="",t=tenant.language;switch(t){case"zh_CN":e="为避免相同数据重复提交，建议您一分钟后再试。";break;case"zh_HN":e="為避免相同數據重複提交，建議您一分鐘後再試。";break;case"de":e="Um die gleichen Daten nicht zu wiederholen, empfiehlt es sich, in einer Minute erneut zu versuchen.";break;case"en":e="To avoid duplicate submission of the same data, it is recommended that you try again in a minute.";break;case"es":e="Para evitar la repetición de los mismos datos, se recomienda intentarlo en un minuto.";break;case"fr":e="Pour éviter la répétition des mêmes données, il est recommandé que vous réessayez dans cinq minutes.";break;case"ja":e="同じデータが重複しないように、1分後に再試行することをおすすめします。";break;case"ko":e="같은 데이터가 반복되는 것을 피하기 위해서 1분 후에 다시 시도할 것을 건의합니다.";break;case"pt":e="Para evitar a submissão duplicada DOS mesmos dados, recomenda-se que você tente novamente EM um minuto.";break;case"ru":e=" во избежание повторения одних и тех же данных рекомендуется попробовать через минуту."}return e}var d=this._params,p=$compCl.getScope(d.id),f=(d.CorrectRequired&&d.CorrectRequired,d.DataFailed&&d.DataFailed,!0),u=!0,l="",m="/comp/touch/cfrs",h="GET",v='<div class="e_LoginPrompt p_LoginPrompt corlor_warning" data-ename="表单错误提示语"><i class="iconfont icon-error"></i><span class="text-error color_error">手机号码不能为空或格式不正确！</span></div>',g=!1,_=function(e,t){return t.removeClass("error").addClass("success"),t.find(".p_LoginPrompt").remove().end().append(v),t.find(".text-error").text(""),l="",l},x=function(e,t){function a(t){if(t.data&&""!==t.data){var a=JSON.parse(t.data);if("101"==a.status){var i=e.find(".p_image img");i.attr("src",a.data.imgSrc),i.attr("data-id",a.data.captchaId)}}}var i={compId:t.id};o(e,t,"/interactionApi/captcha/getCaptcha",i,"CET",a)};x(p,d);var y=p.find(".p_image");y.off("click"),y.on("click",function(){x(p,d)}),r(p,d),p.find(".e_box .e_droplist").off("click").on("click",["li","input",".shape"],function(t){t.stopPropagation(),window.e=t;var a=e(this).closest(".p_selectC"),i=(e(this),e(this).closest(".e_box")),n=i.find(".e_droplist"),r=i.find(".shape"),s=n.find(".itembox"),o=t.target.tagName.toLowerCase(),c=function(){r.removeClass("clicked"),s.addClass("item_hide"),i.css({overflow:"hidden"}),n.removeClass("hover"),e(document).off("click")},d=function(){r.addClass("clicked"),s.removeClass("item_hide"),i.css({overflow:"visible"}),n.addClass("hover"),e(document).on("click",c)};if("input"===o||e(t.target).hasClass("shape"))return t.stopPropagation(),r.hasClass("clicked")?c():d(),!1;var p=e(t.target).closest("li"),f=p.text().trim(),u=p.attr("idx");n.find("input").val(f),i.find("input.d_select").val(u).data("status",1),a.removeClass("error").addClass("success"),c()}),p.find(".e_box").off("click").on("click",".e_checkbox",function(t){var a=e(this).closest(".e_box"),i=a.find("input[type='checkbox']:checked").length;i>0?a.find("input").data("status",1):a.find("input").data("status",0)}),p.on("blur",".InputText:visible",function(){var t=e(this);n(t)}),p.find("input[type='radio']").data("status",1);var b=function(t,i){var n=t.find(".p_sendBtn");n.off("click"),n.each(function(){e(this).on("click",function(){var n=e(this),r="";r=e(this).hasClass("mailBtn")?e(this).parent().parents(".p_aaa").find(".p_EmailBox"):e(this).parent().parents(".p_aaa").find(".p_PhoneBox");var s={compType:i.id,verifyType:"SMS",verifyName:r.find("input").val()};return e(this).hasClass("mailBtn")&&(s.verifyType="EMAIL"),(!r.find(".corlor_warning .color_error")||""==r.find(".corlor_warning .color_error").text())&&(""==r.find("input").val()?(r.find("input").trigger("blur"),!1):void o(t,i,"/interactionApi/member/account/sendVerify",s,"GET",function(e){if(e.data&&""!==e.data){var i=JSON.parse(e.data);if("101"==i.status){t.find(".p_sendBtn").css("display","none");var r=60;n.attr("disabled",!0),n.parent().next().removeClass("item_hide"),n.removeAttr("disabled"),t.find(".p_sendTimerBox").css("display","inline-block !important");var s=setInterval(function(){n.parent().next().find("span").text(--r),r<0&&(t.find(".p_sendBtn").css("display","block"),t.find(".p_sendTimerBox").css("display","none !important"),r=60,n.removeAttr("disabled"),n.parent().next().addClass("item_hide"),n.parent().next().find("span").text(r),clearInterval(s))},1e3)}else a(n.parent(),n.parent().prev(),i.msg)}}))})})};b(p,d);var C=function(t,a,i){if(!(a.find("input[name=captchas]").length>0)||a.find("input[name=captchas]").val())if(t.data&&""!==t.data){var n=JSON.parse(t.data);if("101"==n.status){var r=n.data;"1"==r.code?(e.message({type:"success",msg:i.success}),setTimeout(function(){var e=i.submitUrl,t=i.submitTarget;""==e?window.location.reload():"_blank"==t?window.open(e):window.location.href=e},500),S=!1):"-3"==r.code?e.message({type:"error",msg:s()}):e.message({type:"error",msg:i.submitError})}else e.message({type:"error",msg:i.submitError})}else e.message({type:"error",msg:i.submitError})},k=!0,w=!0,T=!0,I=!0,S=!0,B=!0,P="";p.off("click",".p_submit"),p.on("click",".p_submit",function(){var t=!1;if(p.find(".p_LoginPrompt").each(function(){""!==e(this).find(".color_error").text()&&(t=!0,e(this).parent().attr("class").indexOf("success")>-1&&e(this).parent().removeClass("success").addClass("error"),e(this).parents(".p_SectorBox").css({overflow:"visible"}))}),!t){if(c(m,{},h,function(e){B=200==e.code}),!S)return!1;var i={},r=[],s={compId:d.id};p.find(".p_itemBox").length;p.find(".InputText:visible").each(function(){var t=e(this).parent(),r=e(this).attr("name");if(r){var o=e(this).attr("tit"),c=e(this).val();if(s[r]=c,"true"==e(this).attr("data-required")){if(""!=l)return k=!1,w=!0,k;if(""==c)return i[r]=e(this).data("status"),a(e(this),t,o+d.mp),k=!1,w=!0,k;i[r]=c,n(e(this)),k=!0,w=!0}else""!=c?(i[r]=c,n(e(this)),k=!0,w=!0):(k=!0,w=!0)}}),p.find(".p_SectorBox").each(function(){var t=e(this).find(".d_select").attr("data-required"),n=e(this).find(".p_selectC"),r=e(this).find(".d_select").attr("tit"),s=e(this).find("select.InputText");s.each(function(){var o=e(this),c=e(this).find("option"),p=e(this).parent().prev().attr("name"),f=!1;c.each(function(){o.val()==e.trim(e(c).eq(0).val())&&(f=!0)}),f?"true"==t&&(a(e(this),n,r+d.mp),e(this).parents(".p_SectorBox").css({overflow:"visible"}),w=!1):(i[p]=s.map(function(){return e(this).val()}).get().join(","),w=!0)})}),p.find(".p_GenderBox").each(function(){var t=e(this).find("input[type='radio']:checked");T&&0==t.length?"false"==p.find(".p_GenderBox input").attr("data-required")?T=!0:(e.message({msg:d.CorrectRequired,type:"error"}),T=!1):e(this).find("input[type='radio']").each(function(){var a=e(this).attr("name");e(this).prop("checked")&&(i[a]=t.map(function(){return e(this).val()}).get().join(","),0==t.length?radioFlag2=!1:radioFlag2=!0)})}),p.find(".p_checkboxContainerBox").each(function(){var t=e(this).find("input[type='checkbox']:checked");k&&0==t.length?"false"==p.find(".p_checkboxContainerBox input").attr("data-required")?I=!0:(e.message({msg:d.CorrectRequired,type:"error"}),I=!1):e(this).find("input[type='checkbox']").each(function(){var a=e(this).attr("name");e(this).prop("checked")&&(i[a]=t.map(function(){return e(this).val()}).get().join(","),I=!0)})}),i.selectId=d.selectId,p.find("input[type='radio']").each(function(){var t=e(this).attr("name");i[t]=p.find("input:radio[name="+t+"]:checked").val()}),i.messageId=p.find("#categoryId").val(),i.captchas=p.find("input[name=captchas]").val(),i.captchaId=p.find(".p_image img").attr("data-id"),e.ajax({url:"https://www.taobao.com/help/getip.php",type:"GET",async:!1,dataType:"jsonp"}),window.ipCallback=function(t){t&&(console.log(P,"用户ip"),i.realIP=t.ip||"",i.refererUrl=window.location.pathname+window.location.search,0!=p.find("input[name=captchas]").length||null!=i.captchas&&"undefined"!=i.captchas||(g=!0),p.find(".InputText").each(function(){var t=e(this);"phoneCode"!=t.attr("name")&&"mailCode"!=t.attr("name")||n(t)}),0==r.length&&k&&w&&T&&I&&g&&u&&B&&(p.find(".p_LoginPrompt").remove(),o(p,d,"/interactionApi/message/add",{formData:i},"POST",C,!1)))}}})};return{init:d}});